syntax = "proto3";

package model;

option go_package = "";

// Transaction
message TxBox {
  bytes tee_sig = 1;
  bytes org = 2; 
  bytes tx = 3;
}

message Tx{
  oneof payload {
    string test = 99;
    EpochEnd epoch_end = 1;
    int64 epoch_start = 2;
    Bridge bridge = 3;
    HubCall hub_call = 4;
    int64 sync_tx_start  = 5;
    int64 sync_tx_end = 6;
  }
}

// SideValidator
message SideValidator {
  bytes pubkey = 1;
  int64 power = 2;
}

// Call from TEE to mainchain
message EpochEnd {
  uint32 epoch = 1;
  repeated SideValidator validators = 2;
  bytes dkg_pub = 3;
}

// Call from TEE to mainchain
message Bridge {
  string msg_id = 1;
  bytes payload = 2;
}

// Polkadot Hub Call
message HubCall {
  repeated IndexCall call = 2;
}

// Call with index
message IndexCall {
  int64 index = 1;
  bytes call = 2;
}

// dkg message
message DkgMessage {
  string from = 1;
  To to = 2;
  string msg_id = 3;
  bytes payload = 4;
  string error = 5;
  string type = 6;
}

// block 
message BlockPartialSign {
  string from = 1;
  To to = 2;
  int64 tx_index = 3;
  bytes hub_sig = 4;
}

message To {
  oneof payload {
    bool broadcast  = 1;
    Nodes nodes = 2;
    bytes node = 3;
  }
}

message Nodes {
  repeated bytes l = 2;
}