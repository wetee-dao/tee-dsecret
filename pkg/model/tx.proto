syntax = "proto3";

package model;

option go_package = "";

// transaction
message TxBox {
  bytes tee_sig = 1;
  bytes org = 2; 
  bytes tx = 3;
}

// side chain transaction
message Tx{
  oneof payload {
    // string test = 99;
    EpochEnd epoch_end = 1;
    int64 epoch_start = 2;
    Bridge bridge = 3;
    HubCall hub_call = 4;
    int64 sync_tx_start  = 5;
    int64 sync_tx_end = 6;
  }
}

// side validator
message SideValidator {
  bytes pubkey = 1;
  int64 power = 2;
}

// Call from TEE to mainchain
message EpochEnd {
  uint32 epoch = 1;
  repeated SideValidator validators = 2;
  bytes dkg_pub = 3;
}

// Call from TEE to mainchain
message Bridge {
  string msg_id = 1;
  bytes payload = 2;
}

// Polkadot Hub Call
message HubCall {
  repeated TeeCall call = 2;
}

// DKG message
message DkgMessage {
  string from = 1;
  To to = 2;
  string msg_id = 3;
  bytes payload = 4;
  string error = 5;
  string type = 6;
}

// block partial sign
message BlockPartialSign {
  string from = 1;
  To to = 2;
  int64 tx_index = 3;
  bytes hub_sig = 4;
}

// p2p msg send to
message To {
  oneof payload {
    bool broadcast  = 1;
    Nodes nodes = 2;
    bytes node = 3;
  }
}

// multi node
message Nodes {
  repeated bytes l = 2;
}

// TEE call
message TeeCall{
  bytes caller = 1;
  int64 time = 2;
  uint32 tee_type = 3;
  bytes report = 4;
  oneof tx {
    PodStart pod_start = 5;
    PodMint pod_mint = 6;
    BridgeCall bridge_call = 7;
    bytes text = 8;
    UploadSecret upload_secret = 9;
  }
}

// polkadot hub pod mint call
message PodStart {
  uint64 Id = 1;
}

// polkadot hub pod mint call
message PodMint {
  uint64 Id = 1;
  bytes reportHash = 3;
}

// polkadot hub pod mint call
message BridgeCall {
  int64 time = 1;
}

// TEE report verify result
message TeeVerifyResult {
  uint32 tee_type = 1;
  bytes code_signer = 2;
  bytes code_signature = 3;
  bytes code_product_id = 4;
}

// Upload secret hash
message UploadSecret {
  bytes user = 1;
  uint64 index = 2;
  bytes data = 3;
  uint64 time = 4;
  bytes sig = 5;
}

message TeeTrigger{
  TeeCall tee = 1;
  uint64 cluster_id = 2;
  repeated uint64 callids = 3;
}