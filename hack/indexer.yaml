apiVersion: apps/v1
kind: Deployment
metadata:
  name: wetee-dsecret
  namespace: worker-addon
spec:
  selector:
    matchLabels:
      app: wetee-dsecret
  template:
    metadata:
      labels:
        app: wetee-dsecret
    spec:
      containers:
        - name: c0
          image: registry.cn-hangzhou.aliyuncs.com/wetee_dao/dsecret:2024-07-01-08_45
          volumeMounts:
            - name: wetee-dsecret-cache
              mountPath: /opt/wetee-cache
          resources:
            limits:
              alibabacloud.com/sgx_epc_MiB: 10
            requests:
              alibabacloud.com/sgx_epc_MiB: 10
        - name: c1
          image: wetee/cvm-ssl-proxy:2024-05-18-11-47
          ports:
            - containerPort: 443
              name: dsecret-443
              protocol: TCP
          env:
            - name: KEY
              value: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb0FJQkFBS0NBUUVBdnNHRml0MmVDa0REYi8zYUFBekdyMlVzazNQbFZoaWpWcmNITE1IN1dRdUNOdzFGCkk3TkV2eWVRNHM2MTU1ZG5aM0lTcW02dlpMczVrRFFtRExORTlYaGZhUno3UlVoa3FCSkVPa28xY3U0U0xTQVIKRnphbWJpMzMwVTFROHpkY1prV0tsSGxyTXhCNTFKZXhpQmxDWlFYYldyUmtYUGhMNGFQZi9GYkFhWkdvNmV5awphZXNuVXJmQXJ1SFN6cjNMZEFBekhBRWhVbTQzYTlYeU1GbUlETjl5RURvbXVQUlQ4NlJTUmVDR1N6ZzJYeFdqCmpHdUhyeEF0OUdpenhtZmNaZ2U5SEJ1d3YrYzNIVnVlTVFpL3lDd3BVczFJNVdIVUpJcVpwTExkMFlYTWwwQloKTDZ4L29JNjdKVEtDTmI3Tmk2N0FCMllGWXcwSjNza1ZWN2craVFJREFRQUJBb0gvTklnV3ZxZEpYb2wzU09BZgpxT1BiMDNHSlZSSVZsaUF5Mnk2TVMwY2djT1U2ZHU2d202UkN5bUdiQk5yb1BWNzBtd2hQRzZCZnJOM2lmRlBnCkpwODMzbUhINUtxV2gvM251bUZOYU1BRytCK1g0ZFZ5MzNHdFk2cEZGTjYxN0VUU3JWZDVVbW9kbTNKdUdwMnIKeGs4dWVhT2pSTmRvekRHVXRBN3RJQkREN0U0MjZGeHhZQzZzOUFaRzhndGV3ZU1VU3JWeXZ6anowaGVoSWovMwo2SS9jZldGcjh4N0dVSE0xNCtObGZiWmNvdUNnN0xCU2xzM1pvZnNhQXJVYU5YbEc3MkYyU2VDVVlOeCtzaDZqCmlvVmZHUU5TLzRKRmtTSDhhQnp2bVQzN0RacytnenZYOEJIdVJuVkRibjBHaUdyYjI2L3cyTjMrVWprVHR2aHQKNHV0SkFvR0JBT1d1eGpEcVJ0blNIcVZJYktPZXBhRDlaVWw3T3MyYXVEVE82WFNKTU00Tlpjc3hIdjVwNUVGOQpqUjVOUGw3SUxtS0lqN2JUQUNxZ3N6S0VzTlVkdjZqR2FST2ZlcWQzMmFCWk44dGxwdXQwWUlwaXdzbHh4b0c1CnppYXUzQkVlMExka1V1RlN1MnB0V3h3UFV3a2diSHFnTUJ3Y0Z3ZTVuS0l6emVMb1ByNVZBb0dCQU5TYzZ4UTYKTWJ2RERIZ2EyYlpESWRaTHpPQzE4UzF1N0tqVDFJUlhLWkFOSHpGNVI3dWNVVmdJeTdqeXlxRzFBWnAxSk16WgpvOTR4ZVM1TjZrdm1ISE9BTG5mWnp1ZXNJRFNFTFlDQ0xYNlFJVHphM0NERDF3dDNGZnd0ZWVwOXZSVEVRWUlpClA2R1FNM3NzajczL3ZkWjFVQ29tR3VyU2FZTWcwcnNnSTR0bEFvR0FMOHJuV0tSWEs5b0tJSEJxa3IxZlQ1bUsKcXZpbWFzUUlFb3ovalExREI0MUlJampOYnprUGt3VVNDVDBmZms5L1AyZVZLQURONXhEYldPYTllUXNncDNqcAp3bmlMNkM4TExNK0R5YUlVVXFnN3NuQU1naWhYbXdUVHZiN2k4ZmtNaXl5b0JsVFZ4TGFPbjg4Y2d5aXBDZmN0Cks1dzR1cFhIM3dTU2tlV3JzS1VDZ1lBemJURS9WMFFvVW1sMXM2anRlUmQ2S2lPSVJ2bnJMMlYzQUtYcXpOcDAKeVhlK0U4UFNFV0ZybGRVUkMwa1FEQ1F6SkJxZW9oWU03SktQTExGN1lsR0hibjNPNTVRd1hXWDh6ZXZqcFpregpmOUZLVXZYanh2c0EvdkVHYWttTytwTDlydXJaZTBkQTRReFN3dGlSOElZT2xabXFXRVV5ZjJxZUdSWmZ4TXBVCk1RS0JnR2gycnpLbVFTM1RVaXhNVVJRRisxMDlJYnlTTE0zdWZDNnBzQ29xOXpBcHNpWmdnVDhLQkRPUXNkSDQKZEU3ZkhpdzJCejV0S2hyTmwvRjAzN2xEamdiZkNxZUFMektIa3JscXRuZlorN1RwRmVqYzA4cEsxYnJJbzRPQQo3QWZtSEo2NHNHS3lhSmFZNUp4a1NES3dXSzBiVkRYYklSMUZNaXhZOEx2bEFIOGsKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K|LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUYrVENDQk9HZ0F3SUJBZ0lRQnphRkwyTmdWWTZvZzI4L05zT1BIakFOQmdrcWhraUc5dzBCQVFzRkFEQnUKTVFzd0NRWURWUVFHRXdKVlV6RVZNQk1HQTFVRUNoTU1SR2xuYVVObGNuUWdTVzVqTVJrd0Z3WURWUVFMRXhCMwpkM2N1WkdsbmFXTmxjblF1WTI5dE1TMHdLd1lEVlFRREV5UkZibU55ZVhCMGFXOXVJRVYyWlhKNWQyaGxjbVVnClJGWWdWRXhUSUVOQklDMGdSekl3SGhjTk1qUXdOVEEwTURBd01EQXdXaGNOTWpRd09EQXhNak0xT1RVNVdqQWIKTVJrd0Z3WURWUVFERXhCNGFXRnZZbUZwTG1GemVXOTFMbTFsTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQwpBUThBTUlJQkNnS0NBUUVBdnNHRml0MmVDa0REYi8zYUFBekdyMlVzazNQbFZoaWpWcmNITE1IN1dRdUNOdzFGCkk3TkV2eWVRNHM2MTU1ZG5aM0lTcW02dlpMczVrRFFtRExORTlYaGZhUno3UlVoa3FCSkVPa28xY3U0U0xTQVIKRnphbWJpMzMwVTFROHpkY1prV0tsSGxyTXhCNTFKZXhpQmxDWlFYYldyUmtYUGhMNGFQZi9GYkFhWkdvNmV5awphZXNuVXJmQXJ1SFN6cjNMZEFBekhBRWhVbTQzYTlYeU1GbUlETjl5RURvbXVQUlQ4NlJTUmVDR1N6ZzJYeFdqCmpHdUhyeEF0OUdpenhtZmNaZ2U5SEJ1d3YrYzNIVnVlTVFpL3lDd3BVczFJNVdIVUpJcVpwTExkMFlYTWwwQloKTDZ4L29JNjdKVEtDTmI3Tmk2N0FCMllGWXcwSjNza1ZWN2craVFJREFRQUJvNElDNURDQ0F1QXdId1lEVlIwagpCQmd3Rm9BVWVOK1JrRi91M3F6MnhYWHIxVXhWVSs4a1NyWXdIUVlEVlIwT0JCWUVGSkExQ3BxYVhIbE11WWxkCjJnaVVMYzQzR1A4YU1Cc0dBMVVkRVFRVU1CS0NFSGhwWVc5aVlXa3VZWE41YjNVdWJXVXdQZ1lEVlIwZ0JEY3cKTlRBekJnWm5nUXdCQWdFd0tUQW5CZ2dyQmdFRkJRY0NBUlliYUhSMGNEb3ZMM2QzZHk1a2FXZHBZMlZ5ZEM1agpiMjB2UTFCVE1BNEdBMVVkRHdFQi93UUVBd0lGb0RBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCCkJRVUhBd0l3Z1lBR0NDc0dBUVVGQndFQkJIUXdjakFrQmdnckJnRUZCUWN3QVlZWWFIUjBjRG92TDI5amMzQXUKWkdsbmFXTmxjblF1WTI5dE1Fb0dDQ3NHQVFVRkJ6QUNoajVvZEhSd09pOHZZMkZqWlhKMGN5NWthV2RwWTJWeQpkQzVqYjIwdlJXNWpjbmx3ZEdsdmJrVjJaWEo1ZDJobGNtVkVWbFJNVTBOQkxVY3lMbU55ZERBTUJnTlZIUk1CCkFmOEVBakFBTUlJQmZ3WUtLd1lCQkFIV2VRSUVBZ1NDQVc4RWdnRnJBV2tBZGdEdXpkQmsxZHNhenNWY3Q1MjAKelJPaU1vZEdmTHpzM3NOUlNGbEdjUisxbXdBQUFZOURsd3FIQUFBRUF3QkhNRVVDSVFDUk9RazUwQnZzWm9CVgpieUc4R0NOanExUDlWVkw4L05WY296bHJCOHdQcUFJZ08xM1R6Y3crcW82Q0RNd2N5T3AxS0d4dHRoZm5aLzcyCm5SUmxzK2gxL2g4QWRnQklzT05yMnFaSE5BL2xhZ0w2blREckhGSUJ5MWJkTElIWnU3K3JPZGlFY3dBQUFZOUQKbHdvNUFBQUVBd0JITUVVQ0lHYWl4TDJBZHc1Y3ZiL2dneEE5U1U1aEpVR0F1TjZ5RW5xbkVpZ2dROXFuQWlFQQowU2E4ckVycnNTanVDdDVkTTY1T0NRQWVTcGZEZFM1NlZ2ejRNdzZCRU0wQWR3RGF0cjlyUDdXMklwK2J3cnRjCmEraHdrWEZzdTFHRWhUUzlwRDB3U05mN3F3QUFBWTlEbHdvd0FBQUVBd0JJTUVZQ0lRRDJ4aTJiNkhEM0E1SjIKQnNZZUNOS3NkSUJlNE9RZzhxdWNSNElzbWxkVzV3SWhBTzFaWFYwZkcxRzM2U0NJVnFZNE1CeHlKYjBzYllObApNVFR1dklnSGo2RytNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUJHTWVHa08rQW9qRTlBZDJOYnJKWFdkNUo2CjAvTGtWU1BTa3VMbkh0YWh2YTZkRERITUM1SHNISmtoTkgxM0ljMUlSQVNaaHdhWmlyTllZaEJZTmhwSjM0dGgKc1Vab2VsR25QVjQ1VVdQOHZLaldjMmoyK1BveWxoNmFyaGdTMlVVRENVa3Jnc0pZaGpWTFdzMTQ3SytYZEN3eQpsNHJwTnByd2Mrcm95THJXWlVFcCt5OWlSbjdjNmdhWlk5M09XOFNPNWRnellwTTVENW9mT3RXc1JCMjJzbk01CkpuSnUzd1BsWWFVcWExYnYxL29SL25rSHk0Q1NEZzNJbWI0T0V0Vm5WcERKNE1LdDg3ZFlCTEQvSXZoQ0JkZkQKdllBRm9sNCtTZlRkUk1zSm9WVkEybHV0R0JWQ05MREtCRjQ4TGxrYVUwdGRKNTlxZUwxeWNJeHJsMGkwCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVxakNDQTVLZ0F3SUJBZ0lRRGVEL3RlNWl5MkVRbjJDTW5PMWUwekFOQmdrcWhraUc5dzBCQVFzRkFEQmgKTVFzd0NRWURWUVFHRXdKVlV6RVZNQk1HQTFVRUNoTU1SR2xuYVVObGNuUWdTVzVqTVJrd0Z3WURWUVFMRXhCMwpkM2N1WkdsbmFXTmxjblF1WTI5dE1TQXdIZ1lEVlFRREV4ZEVhV2RwUTJWeWRDQkhiRzlpWVd3Z1VtOXZkQ0JICk1qQWVGdzB4TnpFeE1qY3hNalEyTkRCYUZ3MHlOekV4TWpjeE1qUTJOREJhTUc0eEN6QUpCZ05WQkFZVEFsVlQKTVJVd0V3WURWUVFLRXd4RWFXZHBRMlZ5ZENCSmJtTXhHVEFYQmdOVkJBc1RFSGQzZHk1a2FXZHBZMlZ5ZEM1agpiMjB4TFRBckJnTlZCQU1USkVWdVkzSjVjSFJwYjI0Z1JYWmxjbmwzYUdWeVpTQkVWaUJVVEZNZ1EwRWdMU0JICk1qQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU84VWY0NmkvbnI3cGtnVERxbkUKZVNJZkNGcXZQblVxM2FGMXRNSjVoaDlNbk82TG10NVVkSGZCR3dDOVNpK1hqSzEyY2paZ3hPYnNMNlJnMW5qdgpOaEFNSjRKdW5OMEpHR1JKR1NldmJKc0Ezc2M2OG5iUFF6dUtwNUpjOHZwcnlwMm10czM4cFNDWG9yUFIrc2NoClFpc0tBN09TUTFNamNGTjBkN3RicmNlV0ZOYnpnTDJjc0pWUWVvZ09CR1NlL0taRUladzZnWExLZUZlN211cG4KTllKUk9pMmlDMTErSHVGNzlpQXR0TWMzMkN2NlVPeGl4WS8zWlYrTHpwTG5rbEZxOThYT1Jnd2tJSkwxSHV2UApoYTh5dmIrVzZKaXNsWkpMK0hMRnRpZG94bUk3UW0zWnlJVjY2VzUzM0RzR0ZpbUZKa3ozeTBHZUhXdVNWTWJJCmxmc0NBd0VBQWFPQ0FVOHdnZ0ZMTUIwR0ExVWREZ1FXQkJSNDM1R1FYKzdlclBiRmRldlZURlZUN3lSS3RqQWYKQmdOVkhTTUVHREFXZ0JST0lsUWdHSlhtNDI3bUQvcjZ1Ukx0QmhlUE9UQU9CZ05WSFE4QkFmOEVCQU1DQVlZdwpIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUJJR0ExVWRFd0VCL3dRSU1BWUJBZjhDCkFRQXdOQVlJS3dZQkJRVUhBUUVFS0RBbU1DUUdDQ3NHQVFVRkJ6QUJoaGhvZEhSd09pOHZiMk56Y0M1a2FXZHAKWTJWeWRDNWpiMjB3UWdZRFZSMGZCRHN3T1RBM29EV2dNNFl4YUhSMGNEb3ZMMk55YkRNdVpHbG5hV05sY25RdQpZMjl0TDBScFoybERaWEowUjJ4dlltRnNVbTl2ZEVjeUxtTnliREJNQmdOVkhTQUVSVEJETURjR0NXQ0dTQUdHCi9Xd0JBakFxTUNnR0NDc0dBUVVGQndJQkZoeG9kSFJ3Y3pvdkwzZDNkeTVrYVdkcFkyVnlkQzVqYjIwdlExQlQKTUFnR0JtZUJEQUVDQVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQW9CczFlQ0xLYWtMdFZSUEZSakJJSjlMSgpMMHM4Wld1bThVOC8xVE1Wa1FNQm4rQ1BiNXhuQ0QwR1NBNkwvVjBaRnJNTnFCaXJycjVCMjQxT2VzRUN2eElpCjk4Ylo5MGg5K3EvWDVlTXlPRDM1ZjhZVGFFTXBkblFDbmF3SXdpSHgwNi8wQmZpVGorYi9YUWloK21xdDNaWGUKeE5DSnFLZXhkaUIySVdHU0tjZ2FoUGFjV2trL0JBUUZpc0tJRllFcUh6Vjk3NFMzRkF6LzhMSWZENTh4bnNFTgpHZnp5SURrSDNKcndZWjhjYVBUZjZaWDlNMUdySVNOOEhuV1R0ZE5DSDJ4RWFqUmEvaDlaQlhqVXlGS1FyR2syCm4yaGNMcmZaU2J5bkVDL3BTdy9FVDdINW5Xd2Nram1BSjFsOWZjbmJxa1UvcGY2dU1RbW5mbDBKUWpKTlNnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
            - name: PORT
              value: '443'
            - name: TO
              value: 127.0.0.1:8881
      volumes:
        - name: wetee-dsecret-cache
          hostPath:
            type: DirectoryOrCreate
            path: /mnt/wetee-cache
      nodeSelector:
        TEE: "SGX"

---
apiVersion: v1
kind: Service
metadata:
  name: wetee-dsecret-service
  namespace: worker-addon
spec:
  type: NodePort
  selector:
    app: wetee-dsecret
  ports:
    - name: http
      protocol: TCP
      nodePort: 30006
      port: 443
      targetPort: 443
